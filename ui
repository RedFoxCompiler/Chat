return (function()
    local Players = game:GetService("Players")
    local UserInputService = game:GetService("UserInputService")
    local HttpService = game:GetService("HttpService")
    local CoreGui = game:GetService("CoreGui")
    local StarterGui = game:GetService("StarterGui")
    local TextChatService = game:GetService("TextChatService")
    local TweenService = game:GetService("TweenService")
    local RunService = game:GetService("RunService")

    local LocalPlayer = Players.LocalPlayer
    
    local function GetUniversalRequest()
        if request then return request end
        if http_request then return http_request end
        if syn and syn.request then return syn.request end
        if fluxus and fluxus.request then return fluxus.request end
        if krnl and krnl.request then return krnl.request end
        if getgenv().request then return getgenv().request end
        return nil
    end

    local HttpRequest = GetUniversalRequest()
    local GetAsset = getcustomasset or getsynasset
    local WriteFile = writefile
    local ReadFile = readfile
    local IsFile = isfile

    if not HttpRequest then
        game:GetService("StarterGui"):SetCore("SendNotification", {
            Title = "Erro CrÃ­tico",
            Text = "Seu executor nÃ£o suporta HTTP Requests.",
            Duration = 10
        })
        return
    end

    pcall(function() StarterGui:SetCoreGuiEnabled(Enum.CoreGuiType.Chat, false) end)
    pcall(function() 
        if TextChatService:FindFirstChild("ChatWindowConfiguration") then
            TextChatService.ChatWindowConfiguration.Enabled = false 
            TextChatService.ChatInputBarConfiguration.Enabled = false
        end
    end)

    local UrlBytes = {104,116,116,112,115,58,47,47,115,116,117,100,105,111,45,57,52,48,50,51,54,51,51,54,51,45,98,56,100,98,101,45,100,101,102,97,117,108,116,45,114,116,100,98,46,102,105,114,101,98,97,115,101,105,111,46,99,111,109,47,99,104,97,116}
    local function GetUrl()
        local s = ""
        for _, b in ipairs(UrlBytes) do s = s .. string.char(b) end
        return s
    end
    local DatabaseURL = GetUrl()

    local MasterUser = "leolindoxx25"
    
    local Theme = {
        Background = Color3.fromRGB(20, 20, 20),
        Input = Color3.fromRGB(35, 35, 35),
        Text = Color3.new(0.95, 0.95, 0.95),
        Scrollbar = Color3.fromRGB(80, 80, 80),
        Mention = Color3.fromRGB(80, 0, 0),
        Highlight = Color3.fromRGB(255, 36, 0)
    }

    local function CreateElement(className, properties)
        local instance = Instance.new(className)
        local cornerRadius = properties.CornerRadius
        local gradientRotation = properties.GradientRotation
        
        properties.CornerRadius = nil
        properties.GradientRotation = nil
        
        for name, value in pairs(properties) do
            instance[name] = value
        end
        
        if cornerRadius then
            local corner = Instance.new("UICorner")
            corner.CornerRadius = UDim.new(0, cornerRadius)
            corner.Parent = instance
        end

        if gradientRotation then
            local gradient = Instance.new("UIGradient")
            gradient.Rotation = gradientRotation
            gradient.Transparency = NumberSequence.new{
                NumberSequenceKeypoint.new(0, 0),
                NumberSequenceKeypoint.new(1, 1)
            }
            gradient.Parent = instance
        end
        
        return instance
    end

    for _, child in pairs(CoreGui:GetChildren()) do
        if child.Name:find("UniversalChatSystem") then child:Destroy() end
    end

    local ScreenGui = CreateElement("ScreenGui", {
        Name = "UniversalChatSystem_" .. math.random(1000, 9999),
        ResetOnSpawn = false,
        Parent = CoreGui
    })

    local ToggleButton = CreateElement("TextButton", {
        Name = "ToggleChat",
        Parent = ScreenGui,
        Size = UDim2.new(0, 60, 0, 32),
        Position = UDim2.new(1, -80, 0, 10),
        BackgroundColor3 = Theme.Input,
        Text = "Chat",
        Font = Enum.Font.GothamBold,
        TextColor3 = Color3.new(1, 1, 1),
        TextSize = 14,
        BackgroundTransparency = 0.2,
        CornerRadius = 6
    })

    local MainFrame = CreateElement("Frame", {
        Name = "MainContainer",
        Parent = ScreenGui,
        Size = UDim2.new(0, 480, 0, 240),
        Position = UDim2.new(0, 10, 0, 10),
        BackgroundColor3 = Theme.Background,
        BackgroundTransparency = 0.05,
        Active = true,
        Draggable = false,
        CornerRadius = 8
    })

    local ScrollFrame = CreateElement("ScrollingFrame", {
        Name = "MessageList",
        Parent = MainFrame,
        Size = UDim2.new(1, -10, 1, -45),
        Position = UDim2.new(0, 5, 0, 5),
        BackgroundTransparency = 1,
        ScrollBarThickness = 3,
        ScrollBarImageColor3 = Theme.Scrollbar,
        AutomaticCanvasSize = Enum.AutomaticSize.Y,
        CanvasSize = UDim2.new(0, 0, 0, 0)
    })

    local ListLayout = CreateElement("UIListLayout", {
        Parent = ScrollFrame,
        Padding = UDim.new(0, 4),
        SortOrder = Enum.SortOrder.LayoutOrder
    })

    local InputContainer = CreateElement("Frame", {
        Parent = MainFrame,
        Size = UDim2.new(1, -10, 0, 30),
        Position = UDim2.new(0, 5, 1, -35),
        BackgroundColor3 = Theme.Input,
        CornerRadius = 6
    })

    local SendButton = CreateElement("TextButton", {
        Parent = InputContainer,
        Size = UDim2.new(0, 30, 1, 0),
        Position = UDim2.new(1, -30, 0, 0),
        BackgroundTransparency = 1,
        Text = ">",
        TextColor3 = Color3.new(1, 1, 1),
        Font = Enum.Font.GothamBold,
        TextSize = 18
    })

    local InputBox = CreateElement("TextBox", {
        Parent = InputContainer,
        Size = UDim2.new(1, -35, 1, 0),
        Position = UDim2.new(0, 5, 0, 0),
        BackgroundTransparency = 1,
        Text = "",
        PlaceholderText = "Escreva aqui...",
        TextColor3 = Theme.Text,
        PlaceholderColor3 = Color3.fromRGB(150, 150, 150),
        Font = Enum.Font.Gotham,
        TextSize = 13,
        TextXAlignment = Enum.TextXAlignment.Left,
        ClearTextOnFocus = false,
        TextWrapped = true,
        MultiLine = false,
        ClipsDescendants = true
    })

    local function FormatMessage(msg)
        local myName = LocalPlayer.Name:lower()
        local myDisplay = LocalPlayer.DisplayName:lower()
        local msgLower = msg:lower()
        local isMentioned = false

        if msgLower:find("@" .. myName) or msgLower:find("@" .. myDisplay) then
            isMentioned = true
            msg = msg:gsub("@" .. LocalPlayer.Name, "<font color='#ff2400'><b>@" .. LocalPlayer.Name .. "</b></font>")
            msg = msg:gsub("@" .. LocalPlayer.DisplayName, "<font color='#ff2400'><b>@" .. LocalPlayer.DisplayName .. "</b></font>")
        end
        return msg, isMentioned
    end

    local function DownloadMedia(url, extension, callback)
        if not (GetAsset and WriteFile) then return end
        task.spawn(function()
            local fileName = "rc_media_" .. math.random(10000, 99999) .. extension
            local response = HttpRequest({Url = url, Method = "GET"})
            
            if response and response.Success then
                WriteFile(fileName, response.Body)
                callback(fileName)
            end
        end)
    end

    local function CreateMessageBubble(sender, message, realName)
        local formattedText, pinged = FormatMessage(message)
        
        local bgTransparency = 0.2 
        local bgColor = Color3.new(0, 0, 0)
        local textColor = Theme.Text
        
        if pinged then
            bgColor = Theme.Mention
            textColor = Color3.new(1, 1, 1)
            pcall(function()
                StarterGui:SetCore("SendNotification", {
                    Title = "Nova MenÃ§Ã£o",
                    Text = sender .. " marcou vocÃª!",
                    Duration = 5,
                    Icon = "rbxassetid://16433367963"
                })
            end)
        end

        local BubbleFrame = CreateElement("Frame", {
            Parent = ScrollFrame,
            BackgroundTransparency = bgTransparency,
            BackgroundColor3 = bgColor,
            AutomaticSize = Enum.AutomaticSize.Y,
            Size = UDim2.new(1, 0, 0, 0),
            CornerRadius = 4
        })
        
        BubbleFrame:SetAttribute("BaseTransparency", bgTransparency)
        BubbleFrame:SetAttribute("Hovering", false)

        BubbleFrame.MouseEnter:Connect(function()
            BubbleFrame:SetAttribute("Hovering", true)
            TweenService:Create(BubbleFrame, TweenInfo.new(0.3), {BackgroundTransparency = bgTransparency}):Play()
        end)

        BubbleFrame.MouseLeave:Connect(function()
            BubbleFrame:SetAttribute("Hovering", false)
        end)

        local TextLabel = CreateElement("TextLabel", {
            Parent = BubbleFrame,
            Size = UDim2.new(1, -10, 0, 0),
            Position = UDim2.new(0, 5, 0, 0),
            AutomaticSize = Enum.AutomaticSize.Y,
            BackgroundTransparency = 1,
            RichText = true,
            Font = Enum.Font.Gotham,
            TextSize = 13,
            TextColor3 = textColor,
            TextWrapped = true,
            TextXAlignment = Enum.TextXAlignment.Left,
            Text = "<font color='#aaaaaa'><b>[" .. sender .. "]</b></font>: " .. formattedText
        })

        local isImage = message:find("http") and (message:find("pinterest") or message:find("google") or message:find("cdn.discord") or message:find(".png") or message:find(".jpg"))
        local isAudio = message:find("http") and (message:find(".mp3") or message:find(".ogg") or message:find(".wav"))
        local isVideo = message:find("http") and (message:find(".mp4"))

        if isImage then
            TextLabel.Text = "<font color='#aaaaaa'><b>[" .. sender .. "]</b></font>:"
            
            local ImageContainer = CreateElement("Frame", {
                Parent = BubbleFrame,
                Size = UDim2.new(0, 120, 0, 120),
                Position = UDim2.new(0, 5, 0, 20),
                BackgroundTransparency = 1,
                CornerRadius = 12,
                ClipsDescendants = true
            })
            
            local ImageView = CreateElement("ImageLabel", {
                Parent = ImageContainer,
                Size = UDim2.new(1, 0, 1, 0),
                BackgroundTransparency = 1,
                ScaleType = Enum.ScaleType.Fit,
                Image = "rbxassetid://0"
            })
            
            local GradientTop = CreateElement("Frame", {Parent = ImageContainer, Size = UDim2.new(1, 0, 0.4, 0), BackgroundTransparency = 1, BackgroundColor3 = Color3.new(0,0,0), ZIndex = 5, GradientRotation = -90})
            local GradientBot = CreateElement("Frame", {Parent = ImageContainer, Size = UDim2.new(1, 0, 0.4, 0), Position = UDim2.new(0,0,1,0), AnchorPoint = Vector2.new(0,1), BackgroundTransparency = 1, BackgroundColor3 = Color3.new(0,0,0), ZIndex = 5, GradientRotation = 90})
            
            local DownloadBtn = CreateElement("TextButton", {
                Parent = ImageContainer,
                Size = UDim2.new(0, 40, 0, 25),
                Position = UDim2.new(1, -5, 1, -5),
                AnchorPoint = Vector2.new(1, 1),
                BackgroundTransparency = 1,
                Text = "â†“ â€”",
                TextColor3 = Color3.new(1,1,1),
                Font = Enum.Font.GothamBold,
                TextSize = 14,
                ZIndex = 6,
                Visible = false
            })

            ImageContainer.MouseEnter:Connect(function()
                GradientTop.BackgroundTransparency = 0.3
                GradientBot.BackgroundTransparency = 0.3
                DownloadBtn.Visible = true
            end)

            ImageContainer.MouseLeave:Connect(function()
                GradientTop.BackgroundTransparency = 1
                GradientBot.BackgroundTransparency = 1
                DownloadBtn.Visible = false
            end)

            TextLabel.Text = TextLabel.Text .. "\n\n\n\n\n\n\n\n"
            
            DownloadMedia(message, ".png", function(path)
                ImageView.Image = GetAsset(path)
                DownloadBtn.MouseButton1Click:Connect(function()
                    if WriteFile and ReadFile then
                        WriteFile("Saved_" .. path, ReadFile(path))
                        DownloadBtn.Text = "âœ“"
                        task.wait(1.5)
                        DownloadBtn.Text = "â†“ â€”"
                    end
                end)
            end)

        elseif isAudio then
            TextLabel.Text = "<font color='#aaaaaa'><b>[" .. sender .. "]</b></font>: [AUDIO]"
            TextLabel.Text = TextLabel.Text .. "\n\n"
            
            local PlayBtn = CreateElement("TextButton", {
                Parent = BubbleFrame,
                Size = UDim2.new(0, 100, 0, 25),
                Position = UDim2.new(0, 5, 0, 20),
                BackgroundColor3 = Color3.fromRGB(0, 180, 0),
                Text = "â–¶ Reproduzir",
                TextColor3 = Color3.new(1, 1, 1),
                CornerRadius = 4
            })
            
            PlayBtn.MouseButton1Click:Connect(function()
                PlayBtn.Text = "Baixando..."
                DownloadMedia(message, ".mp3", function(path)
                    local Sound = Instance.new("Sound", workspace)
                    Sound.SoundId = GetAsset(path)
                    Sound:Play()
                    PlayBtn.Text = "Tocando..."
                    Sound.Ended:Wait()
                    PlayBtn.Text = "â–¶ Reproduzir"
                    Sound:Destroy()
                end)
            end)

        elseif isVideo then
            TextLabel.Text = "<font color='#aaaaaa'><b>[" .. sender .. "]</b></font>: [VIDEO]"
            TextLabel.Text = TextLabel.Text .. "\n\n"
            
            local VidBtn = CreateElement("TextButton", {
                Parent = BubbleFrame,
                Size = UDim2.new(0, 120, 0, 25),
                Position = UDim2.new(0, 5, 0, 20),
                BackgroundColor3 = Color3.fromRGB(180, 50, 50),
                Text = "ðŸŽ¥ Baixar MP4",
                TextColor3 = Color3.new(1, 1, 1),
                CornerRadius = 4
            })
            
            VidBtn.MouseButton1Click:Connect(function()
                VidBtn.Text = "Baixando..."
                DownloadMedia(message, ".mp4", function(path)
                    if WriteFile and ReadFile then
                        WriteFile("Video_" .. path, ReadFile(path))
                        VidBtn.Text = "Salvo!"
                    end
                end)
            end)
        end
        
        task.wait()
        ScrollFrame.CanvasPosition = Vector2.new(0, 999999)
    end

    local function SendLogic()
        local msgText = InputBox.Text
        if msgText == "" or msgText:match("^%s*$") then 
            InputBox.Text = "" 
            return 
        end
        
        if string.len(msgText) > 400 then 
            msgText = string.sub(msgText, 1, 400) 
        end

        if msgText == "/console" then
            pcall(function() StarterGui:SetCore("DevConsoleVisible", true) end)
            InputBox.Text = ""
            return
        end

        if msgText == "/globalclear" then
            if LocalPlayer.Name == MasterUser then
                HttpRequest({Url = DatabaseURL .. ".json", Method = "DELETE"})
            end
            InputBox.Text = ""
            return
        end

        if msgText == "/clear" then
            for _, child in pairs(ScrollFrame:GetChildren()) do
                if child:IsA("Frame") then child:Destroy() end
            end
            InputBox.Text = ""
            return
        end

        local payload = HttpService:JSONEncode({
            ["u"] = LocalPlayer.DisplayName,
            ["rn"] = LocalPlayer.Name,
            ["m"] = msgText,
            ["t"] = os.time()
        })

        task.spawn(function()
            HttpRequest({
                Url = DatabaseURL .. ".json",
                Method = "POST",
                Headers = {["Content-Type"] = "application/json"},
                Body = payload
            })
        end)
        InputBox.Text = ""
    end

    InputBox.FocusLost:Connect(function(enterPressed)
        if enterPressed then SendLogic() end
    end)
    
    SendButton.MouseButton1Click:Connect(SendLogic)
    
    ToggleButton.MouseButton1Click:Connect(function()
        MainFrame.Visible = not MainFrame.Visible
    end)

    UserInputService.InputBegan:Connect(function(input, processed)
        if processed then return end
        if input.KeyCode == Enum.KeyCode.Semicolon then
            MainFrame.Visible = not MainFrame.Visible
        end
    end)

    local LastTimestamp = 0
    
    task.spawn(function()
        while task.wait(0.5) do
            local success, response = pcall(function()
                return HttpRequest({Url = DatabaseURL .. ".json", Method = "GET"})
            end)

            if success and response and response.Success then
                if response.Body and response.Body ~= "null" and response.Body ~= "{}" then
                    local data = HttpService:JSONDecode(response.Body)
                    if data then
                        local sortedMsgs = {}
                        for id, msgData in pairs(data) do
                            msgData.id = id
                            table.insert(sortedMsgs, msgData)
                        end
                        
                        table.sort(sortedMsgs, function(a, b) return a.t < b.t end)

                        if #sortedMsgs > 13 then
                            for i = 1, (#sortedMsgs - 13) do
                                task.spawn(function()
                                    HttpRequest({Url = DatabaseURL .. "/" .. sortedMsgs[i].id .. ".json", Method = "DELETE"})
                                end)
                            end
                        end

                        for _, msg in ipairs(sortedMsgs) do
                            if msg.t > LastTimestamp then
                                CreateMessageBubble(msg.u, msg.m, msg.rn)
                                LastTimestamp = msg.t
                            end
                        end
                    end
                end
            end
        end
    end)

    task.spawn(function()
        while task.wait(5) do
            for _, frame in pairs(ScrollFrame:GetChildren()) do
                if frame:IsA("Frame") then
                    if not frame:GetAttribute("Hovering") then
                        TweenService:Create(frame, TweenInfo.new(1.5), {BackgroundTransparency = 1}):Play()
                    end
                end
            end
        end
    end)
end)()
