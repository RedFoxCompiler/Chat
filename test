task.spawn(function()
    local _plugin = nil
    local S,U,H,C,G,T = game:GetService("Players"),game:GetService("UserInputService"),game:GetService("HttpService"),game:GetService("CoreGui"),game:GetService("StarterGui"),game:GetService("TextChatService")
    local L,R = S.LocalPlayer,math.random
    local _D = "https://rdb001-d0bda-default-rtdb.firebaseio.com"
    local _A = getcustomasset or getsynasset
    local _W,_F = writefile,readfile
    local _Req = request or http_request or (syn and syn.request) or (fluxus and fluxus.request)
    local _H = {}

    pcall(function() G:SetCoreGuiEnabled(3,false) end)
    pcall(function() local c=T:FindFirstChild("ChatWindowConfiguration") if c then c.Enabled=false T.ChatInputBarConfiguration.Enabled=false end end)

    local function HTTP(u,m,b)
        if not _Req then return end
        local o={Url=u,Method=m or "GET",Headers={["Content-Type"]="application/json"}}
        if b then o.Body=H:JSONEncode(b) end
        local s,v=pcall(_Req,o)
        return (s and v and v.StatusCode==200) and v.Body or nil
    end

    local function _N(c,p)
        local i=Instance.new(c)
        local cr,gr,dr=p.Cr,p.Gd,p.Dr
        p.Cr,p.Gd,p.Dr=nil,nil,nil
        for k,v in pairs(p) do i[k]=v end
        if cr then local u=Instance.new("UICorner") u.CornerRadius=UDim.new(0,cr) u.Parent=i end
        if gr then local g=Instance.new("UIGradient") g.Color=gr.C g.Rotation=gr.R or 90 g.Parent=i end
        if dr then
            local d,st=false,nil
            i.InputBegan:Connect(function(o) if o.UserInputType==Enum.UserInputType.MouseButton1 then d=true st=o.Position end end)
            U.InputChanged:Connect(function(o) if d and o.UserInputType==Enum.UserInputType.MouseMovement then local dl=o.Position-st i.Position=UDim2.new(i.Position.X.Scale,i.Position.X.Offset+dl.X,i.Position.Y.Scale,i.Position.Y.Offset+dl.Y) st=o.Position end end)
            i.InputEnded:Connect(function(o) if o.UserInputType==Enum.UserInputType.MouseButton1 then d=false end end)
        end
        return i
    end

    for _,x in pairs(C:GetChildren()) do if x.Name:find("CV2_") then x:Destroy() end end
    local Sc=_N("ScreenGui",{Name="CV2_"..R(9e8),Parent=C,ResetOnSpawn=false})
    local M=_N("Frame",{Parent=Sc,Size=UDim2.new(0,420,0,220),Position=UDim2.new(0,10,0,10),BackgroundColor3=Color3.fromRGB(18,18,18),BackgroundTransparency=0.1,Active=true,Dr=true,Cr=6})
    local Sf=_N("ScrollingFrame",{Parent=M,Size=UDim2.new(1,-10,1,-40),Position=UDim2.new(0,5,0,5),BackgroundTransparency=1,ScrollBarThickness=2,AutomaticCanvasSize=2,CanvasSize=UDim2.new(0,0,0,0)})
    _N("UIListLayout",{Parent=Sf,Padding=UDim.new(0,3),SortOrder=2})
    
    local Ib=_N("TextBox",{Parent=_N("Frame",{Parent=M,Size=UDim2.new(1,-10,0,25),Position=UDim2.new(0,5,1,-30),BackgroundColor3=Color3.fromRGB(25,25,25),Cr=6}),Size=UDim2.new(1,-5,1,0),Position=UDim2.new(0,5,0,0),BackgroundTransparency=1,Text="",PlaceholderText="Msg ou /plugin [s/d]",TextColor3=Color3.new(1,1,1),Font=Enum.Font.Gotham,TextSize=13,TextXAlignment=0,ClearTextOnFocus=false})
    _N("TextButton",{Parent=Sc,Size=UDim2.new(0,40,0,20),Position=UDim2.new(1,-50,0,10),BackgroundColor3=Color3.fromRGB(30,30,30),Text="T",TextColor3=Color3.new(1,1,1),Cr=4}).MouseButton1Click:Connect(function() M.Visible=not M.Visible end)

    local function Log(t,c) 
        local l=_N("TextLabel",{Parent=Sc,Size=UDim2.new(0,200,0,25),Position=UDim2.new(0.5,-100,0,20),BackgroundColor3=c or Color3.fromRGB(30,30,30),Text=t,TextColor3=Color3.new(1,1,1),Cr=4,Font=Enum.Font.Gotham}) 
        task.delay(3,function() l:Destroy() end) 
    end

    local function LImg(u,i)
        task.spawn(function()
            if not (_A and _W and _Req) then i.Image="rbxassetid://0" return end 
            local n="t_"..R(9e6)..".png"
            local d=HTTP(u)
            if d then 
                local s,e = pcall(function() _W(n,d) i.Image=_A(n) end)
                if not s then i.Image="rbxassetid://0" end
            end
        end)
    end

    local function Msg(d)
        if _H[d.t..d.rn] then return end _H[d.t..d.rn]=true
        local b=_N("Frame",{Parent=Sf,AutomaticSize=2,Size=UDim2.new(1,0,0,0),BackgroundTransparency=1})
        _N("UIListLayout",{Parent=b,FillDirection=0,SortOrder=2,Padding=UDim.new(0,4)})
        local c=(d.rn==L.Name and Color3.fromRGB(0,255,140)) or Color3.fromHSV((d.rn:byte(1)/255),0.6,1)
        _N("TextLabel",{Parent=b,AutomaticSize=2,BackgroundTransparency=1,Text="["..d.u.."]:",Font=Enum.Font.GothamBold,TextSize=13,TextColor3=c})
        local tx=_N("TextLabel",{Parent=b,AutomaticSize=2,BackgroundTransparency=1,Text=d.m,RichText=true,Font=Enum.Font.Gotham,TextSize=13,TextColor3=Color3.new(0.9,0.9,0.9),TextXAlignment=0,TextWrapped=true})
        
        if d.m:find("http") and (d.m:find("png") or d.m:find("jpg")) then
            tx.Text=""
            LImg(d.m, _N("ImageLabel",{Parent=b,Size=UDim2.new(0,80,0,60),BackgroundTransparency=1,ScaleType=3,Image="rbxassetid://0",Cr=4}))
        end
        Sf.CanvasPosition=Vector2.new(0,9e5)
    end

    local function Snd()
        local t=Ib.Text if not t:find("%S") then return end Ib.Text=""
        if t:sub(1,7)=="/plugin" then
            local a,n=t:sub(9,9),t:sub(11)
            if a=="s" then
                local r=HTTP(_D.."/plugins.json")
                if r then 
                    local w=_N("Frame",{Parent=Sc,Size=UDim2.new(0,200,0,250),Position=UDim2.new(0.5,-100,0.5,-125),BackgroundColor3=Color3.fromRGB(25,25,25),Dr=true,Cr=6})
                    local s=_N("ScrollingFrame",{Parent=w,Size=UDim2.new(1,-10,1,-30),Position=UDim2.new(0,5,0,25),BackgroundTransparency=1,AutomaticCanvasSize=2}); _N("UIListLayout",{Parent=s,Padding=UDim.new(0,2)})
                    _N("TextButton",{Parent=w,Size=UDim2.new(0,20,0,20),Position=UDim2.new(1,-20,0,0),Text="X",BackgroundTransparency=1,TextColor3=Color3.new(1,0,0)}).MouseButton1Click:Connect(function() w:Destroy() end)
                    for k,_ in pairs(H:JSONDecode(r) or {}) do 
                        _N("TextButton",{Parent=s,Size=UDim2.new(1,0,0,20),BackgroundColor3=Color3.fromRGB(35,35,35),Text=k,TextColor3=Color3.new(1,1,1),Cr=4}).MouseButton1Click:Connect(function() 
                            local c=HTTP(_D.."/plugins/"..k..".json") if c then loadstring(H:JSONDecode(c))() Log("ON: "..k,Color3.new(0,1,0)) end 
                        end) 
                    end
                end
            elseif a=="d" and n then
                local c=HTTP(_D.."/plugins/"..n..".json") if c then loadstring(H:JSONDecode(c))() Log("Loaded: "..n,Color3.new(0,1,0)) else Log("404",Color3.new(1,0,0)) end
            end
            return
        end
        if t=="/clear" then for _,c in pairs(Sf:GetChildren()) do if c:IsA("Frame") then c:Destroy() end end return end
        local p={u=L.DisplayName,rn=L.Name,m=t,t=os.time()}
        Msg(p) task.spawn(function() HTTP(_D.."/chat.json","POST",p) end)
    end

    Ib.FocusLost:Connect(function(e) if e then Snd() end end)
    U.InputBegan:Connect(function(k,p) if not p and k.KeyCode==Enum.KeyCode.Slash then task.wait() Ib:CaptureFocus() Ib.Text="" end end)

    task.spawn(function()
        while task.wait(0.8) do
            local r=HTTP(_D.."/chat.json")
            if r and r~="null" then
                local t={} for k,v in pairs(H:JSONDecode(r)) do v.k=k table.insert(t,v) end
                table.sort(t,function(a,b) return a.t<b.t end)
                if #t>15 then HTTP(_D.."/chat/"..t[1].k..".json","DELETE") end
                for _,v in ipairs(t) do Msg(v) end
            end
        end
    end)
    Msg({u="SYS",rn="SYS",m="Chat Loaded. /plugin s",t=os.time()})
end)()
