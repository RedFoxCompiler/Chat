Task.spawn(function()
local _plugin = nil
local S,U,H,C,G,T = game:GetService("Players"),game:GetService("UserInputService"),game:GetService("HttpService"),game:GetService("CoreGui"),game:GetService("StarterGui"),game:GetService("TextChatService")
local L,R = S.LocalPlayer,math.random
local _D = "https://rdb001-d0bda-default-rtdb.firebaseio.com"
local _P = _D.."/plugins"
local _C = _D.."/chat"
local _A = getcustomasset or getsynasset
local _W,_F = writefile,readfile
local _H = {}
pcall(function() G:SetCoreGuiEnabled(Enum.CoreGuiType.Chat,false) end)
pcall(function() local x=T:FindFirstChild("ChatWindowConfiguration") if x then x.Enabled=false T.ChatInputBarConfiguration.Enabled=false end end)

local function _Q(u,m,b)
    local r = request or http_request or (syn and syn.request) or (fluxus and fluxus.request)
    if not r then return end
    local o = {Url=u,Method=m or "GET",Headers={["Content-Type"]="application/json"}}
    if b then o.Body = H:JSONEncode(b) end
    local s,v = pcall(r,o)
    return (s and v and v.StatusCode==200) and v.Body or nil
end

local function _N(c,p)
    local i=Instance.new(c)
    local cr,gr,dr=p.Cr,p.Gd,p.Dr
    p.Cr,p.Gd,p.Dr=nil,nil,nil
    for k,v in pairs(p) do i[k]=v end
    if cr then local u=Instance.new("UICorner") u.CornerRadius=UDim.new(0,cr) u.Parent=i end
    if gr then local g=Instance.new("UIGradient") g.Rotation=gr.R or 90 g.Color=gr.C g.Parent=i end
    if dr then
        local d,dg,st=false,nil,nil
        i.InputBegan:Connect(function(o) if o.UserInputType==Enum.UserInputType.MouseButton1 then d=true dg=o.Position st=i.Position end end)
        U.InputChanged:Connect(function(o) if d and o.UserInputType==Enum.UserInputType.MouseMovement then local dl=o.Position-dg i.Position=UDim2.new(st.X.Scale,st.X.Offset+dl.X,st.Y.Scale,st.Y.Offset+dl.Y) end end)
        i.InputEnded:Connect(function(o) if o.UserInputType==Enum.UserInputType.MouseButton1 then d=false end end)
    end
    return i
end

for _,x in pairs(C:GetChildren()) do if x.Name:find("CV25") then x:Destroy() end end
local Sc = _N("ScreenGui",{Name="CV25_"..R(9e8),Parent=C,ResetOnSpawn=false})
local M = _N("Frame",{Parent=Sc,Size=UDim2.new(0,480,0,240),Position=UDim2.new(0,10,0,10),BackgroundColor3=Color3.fromRGB(15,15,15),BackgroundTransparency=0.1,Active=true,Cr=8})
local Sf = _N("ScrollingFrame",{Parent=M,Size=UDim2.new(1,-10,1,-45),Position=UDim2.new(0,5,0,5),BackgroundTransparency=1,ScrollBarThickness=2,AutomaticCanvasSize=Enum.AutomaticSize.Y,CanvasSize=UDim2.new(0,0,0,0)})
_N("UIListLayout",{Parent=Sf,Padding=UDim.new(0,2),SortOrder=Enum.SortOrder.LayoutOrder})

local If = _N("Frame",{Parent=M,Size=UDim2.new(1,-10,0,30),Position=UDim2.new(0,5,1,-35),BackgroundColor3=Color3.fromRGB(25,25,25),Cr=6})
local Ib = _N("TextBox",{Parent=If,Size=UDim2.new(1,-35,1,0),Position=UDim2.new(0,5,0,0),BackgroundTransparency=1,Text="",PlaceholderText="Msg or /plugin [s/d]",TextColor3=Color3.new(0.9,0.9,0.9),Font=Enum.Font.Gotham,TextSize=13,TextXAlignment=0,ClearTextOnFocus=false})
local Sb = _N("TextButton",{Parent=If,Size=UDim2.new(0,30,1,0),Position=UDim2.new(1,-30,0,0),BackgroundTransparency=1,Text=">",TextColor3=Color3.new(1,1,1),Font=Enum.Font.GothamBold,TextSize=18})
local Tg = _N("TextButton",{Parent=Sc,Size=UDim2.new(0,50,0,25),Position=UDim2.new(1,-60,0,10),BackgroundColor3=Color3.fromRGB(25,25,25),Text="C",TextColor3=Color3.new(1,1,1),Font=Enum.Font.GothamBold,BackgroundTransparency=0.2,Cr=6})

local function _Log(t,c) 
    local l=_N("TextLabel",{Parent=Sc,Size=UDim2.new(0,200,0,30),Position=UDim2.new(0.5,-100,0,10),BackgroundColor3=c or Color3.fromRGB(30,30,30),Text=t,TextColor3=Color3.new(1,1,1),Cr=4,Font=Enum.Font.Gotham}) 
    task.delay(3,function() l:Destroy() end) 
end

local function _LoadImg(u,i)
    task.spawn(function()
        if not _A or not _W then return end
        local n="tmp_"..R(9e8)..".png"
        local d=_Q(u)
        if d then _W(n,d) i.Image=_A(n) end
    end)
end

local function _PlgUI(data)
    local Pw = _N("Frame",{Parent=Sc,Size=UDim2.new(0,250,0,300),Position=UDim2.new(0.5,-125,0.5,-150),BackgroundColor3=Color3.fromRGB(20,20,20),Dr=true,Cr=8,Visible=true})
    _N("TextLabel",{Parent=Pw,Size=UDim2.new(1,-30,0,30),Position=UDim2.new(0,10,0,0),BackgroundTransparency=1,Text="Plugins",TextColor3=Color3.new(1,1,1),Font=Enum.Font.GothamBold,TextXAlignment=0})
    local Cl = _N("TextButton",{Parent=Pw,Size=UDim2.new(0,30,0,30),Position=UDim2.new(1,-30,0,0),BackgroundTransparency=1,Text="X",TextColor3=Color3.fromRGB(255,50,50),Font=Enum.Font.GothamBold})
    Cl.MouseButton1Click:Connect(function() Pw:Destroy() end)
    local Ps = _N("ScrollingFrame",{Parent=Pw,Size=UDim2.new(1,-10,1,-40),Position=UDim2.new(0,5,0,35),BackgroundTransparency=1,AutomaticCanvasSize=2})
    _N("UIListLayout",{Parent=Ps,Padding=UDim.new(0,2)})
    
    if data then
        for k,_ in pairs(data) do
            local b = _N("TextButton",{Parent=Ps,Size=UDim2.new(1,0,0,25),BackgroundColor3=Color3.fromRGB(35,35,35),Text=k,TextColor3=Color3.new(1,1,1),Cr=4})
            b.MouseButton1Click:Connect(function() 
                _Log("Baixando "..k.."...")
                local s = _Q(_P.."/"..k..".json")
                if s then local f=H:JSONDecode(s) if f then loadstring(f)() _Log("Plugin "..k.." Carregado!",Color3.fromRGB(0,200,0)) end end
            end)
        end
    end
end

local function _Msg(u,m,rn,t)
    if _H[t..rn] then return end 
    _H[t..rn]=true

    if m:sub(1,4)=="CMD:" then
        if m=="CMD:CLEAR" then for _,c in pairs(Sf:GetChildren()) do if c:IsA("Frame") then c:Destroy() end end end
        return
    end

    local bx = _N("Frame",{Parent=Sf,AutomaticSize=Enum.AutomaticSize.XY,Size=UDim2.new(1,0,0,0),BackgroundTransparency=1})
    _N("UIListLayout",{Parent=bx,FillDirection=0,SortOrder=2,Padding=UDim.new(0,4)})
    local cl = (rn==L.Name and Color3.fromRGB(0,255,150)) or (rn=="SYS" and Color3.fromRGB(255,50,50)) or Color3.fromHSV((rn:byte(1)/255),0.7,1)
    
    _N("TextLabel",{Parent=bx,AutomaticSize=Enum.AutomaticSize.XY,BackgroundTransparency=1,Text="["..u.."]:",Font=Enum.Font.GothamBold,TextSize=14,TextColor3=cl})
    local tx = _N("TextLabel",{Parent=bx,AutomaticSize=Enum.AutomaticSize.XY,BackgroundTransparency=1,Text=m,RichText=true,Font=Enum.Font.Gotham,TextSize=14,TextColor3=Color3.new(1,1,1),TextXAlignment=0,TextWrapped=true})

    if m:find("http") and (m:find(".png") or m:find(".jpg")) then
        tx.Text=""
        local ib = _N("ImageLabel",{Parent=bx,Size=UDim2.new(0,100,0,80),BackgroundTransparency=1,ScaleType=Enum.ScaleType.Fit,Image="rbxassetid://0",Cr=6})
        _LoadImg(m,ib)
    end
    Sf.CanvasPosition=Vector2.new(0,9e5)
end

local function _S()
    local tx = Ib.Text
    if not tx:find("%S") then return end
    Ib.Text=""
    
    if tx:sub(1,7)=="/plugin" then
        local act = tx:sub(9,9)
        if act=="s" then
            local r = _Q(_P..".json")
            if r then _PlgUI(H:JSONDecode(r)) else _Log("Erro ao buscar plugins") end
        elseif act=="d" then
            local nm = tx:sub(11)
            _Log("Buscando "..nm.."...")
            local r = _Q(_P.."/"..nm..".json")
            if r then 
                local b=H:JSONDecode(r) 
                if b then loadstring(b)() _Log("Plugin ativado!",Color3.fromRGB(0,255,0)) end
            else _Log("Plugin nao achado") end
        end
        return
    end

    if tx=="/clear" then for _,c in pairs(Sf:GetChildren()) do if c:IsA("Frame") then c:Destroy() end end return end
    
    local p={u=L.DisplayName,rn=L.Name,m=tx,t=os.time()}
    task.spawn(function() _Q(_C..".json","POST",p) end)
    _Msg(p.u,p.m,p.rn,p.t) 
end

Sb.MouseButton1Click:Connect(_S)
Ib.FocusLost:Connect(function(e) if e then _S() end end)
Tg.MouseButton1Click:Connect(function() M.Visible=not M.Visible end)
U.InputBegan:Connect(function(k,p) if not p and k.KeyCode==Enum.KeyCode.Slash then task.wait() Ib:CaptureFocus() Ib.Text="" end end)

task.spawn(function()
    while task.wait(0.6) do 
        local r = _Q(_C..".json")
        if r and r~="null" then
            local d = H:JSONDecode(r)
            local s = {}
            for k,v in pairs(d) do v.k=k table.insert(s,v) end
            table.sort(s,function(a,b) return (a.t or 0) < (b.t or 0) end)
            if #s > 15 then _Q(_C.."/"..s[1].k..".json","DELETE") end 
            for _,v in ipairs(s) do _Msg(v.u,v.m,v.rn,v.t or 0) end
        end
    end
end)

_Msg("SYS","Script Loaded. /plugin s to search.", "SYS", os.time())

end)()
